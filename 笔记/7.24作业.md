### 7.24作业

实验环境：
		kubernetes 主节点
		主机名：kube01
		ip地址：10.15.200.241

```shell
# 编写创建mysql.yaml文件
vim mysql.yaml
###
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
spec:
  replicas: 2
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "123.com"
        - name: MYSQL_DATABASE
          value: "good"
        ports:
        - containerPort: 3306
# 下面的service pod 提供了固定ip，负载均衡，自动更新等功能，可以选择性添加，不影响作业成果
# 添加请从---开始粘贴到mysql.yaml文件末尾（---也需要被粘贴）
---
apiVersion: v1
kind: Service
metadata:
  name: mysql
spec:
  selector:
    app: mysql
  ports:
  - port: 3306
###
# 查看是否启动（running）
kubectl get deployments,pods,services
# 等待安装完成
```

 ![image-20240724010954001](https://gitee.com/zhaojiedong/img/raw/master/image-20240724010954001.png)

```shell
# 查看mysql的pod节点，过滤标签为mysql
kubectl get pods -l app=mysql
# 进入mysql验证 注：mysql的pod节点名称随机
kubectl exec -it mysql-8665b6f747-46ms7 -- mysql -uroot -p123.com
kubectl exec -it mysql-8665b6f747-crpbn -- mysql -uroot -p123.com
```

 ![image-20240724011548778](https://gitee.com/zhaojiedong/img/raw/master/image-20240724011548778.png)

 ![image-20240724011533575](https://gitee.com/zhaojiedong/img/raw/master/image-20240724011533575.png)

 ![image-20240724011645608](https://gitee.com/zhaojiedong/img/raw/master/image-20240724011645608.png)

```shell
# 创建nginx-php pod节点
vim nginx-php.yaml
###
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-php
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx-php
  template:
    metadata:
      labels:
        app: nginx-php
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "server { \n  listen 80;\n  root /usr/share/nginx/html;\n  index index.php index.html;\n  location ~ \.php$ { \n    fastcgi_pass localhost:9000; \n    fastcgi_index index.php; \n    include fastcgi_params; \n    fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html/index.php; \n  } \n}" > /etc/nginx/conf.d/default.conf
            nginx -g "daemon off;"
      - name: php
        image: php:7.4-fpm
        ports:
        - containerPort: 9000
###
# 查看pod节点名称
kubectl get pods -l app=nginx-php
# 进入php配置网页文件
kubectl exec -it deployments/nginx-php -c php  -- bash
mkdir -p /usr/share/nginx/html/
echo "<?php phpinfo(); ?>" > /usr/share/nginx/html/index.php
# 查看pod节点IP地址，此时应验证  curl [pod 节点IP]  是否能够出现nginx网页
kubectl get pods nginx-php-6cfd848777-92zpr -o wide
# 进行端口映射
kubectl port-forward --address 0.0.0.0  deployment/nginx-php 9000:80
```

 ![image-20240724022904558](https://gitee.com/zhaojiedong/img/raw/master/image-20240724022904558.png)

![image-20240724023548526](https://gitee.com/zhaojiedong/img/raw/master/image-20240724023548526.png)

 ![image-20240724023708426](https://gitee.com/zhaojiedong/img/raw/master/image-20240724023708426.png)

![image-20240724022944447](https://gitee.com/zhaojiedong/img/raw/master/image-20240724022944447.png)

```shell
# 浏览器访问本机ip
10.15.200.241/index.php
```

